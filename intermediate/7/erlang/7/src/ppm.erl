%%%-------------------------------------------------------------------
%%% @author kim <kim@limmen>
%%% @copyright (C) 2016, kim
%%% @doc
%%%
%%% @end
%%% Created : 26 Jul 2016 by kim <kim@limmen>
%%%-------------------------------------------------------------------
-module(ppm).

%% API
-export([write/2]).

%%%===================================================================
%%% API
%%%===================================================================

%%--------------------------------------------------------------------
%% @doc
%% write(Name, Image) The image is a list of rows, each row a list of
%% tuples {R,G,B}. The RGB values are 0-255. 
%% @spec
%% @end
%%--------------------------------------------------------------------


write(Name, Image) ->
    Height = length(Image),
    Width = length(hd(Image)),
    {ok, Fd} = file:open(Name, [write]),
    io:format(Fd, "P6~n", []),
    io:format(Fd, "#~s~n", ["generated by ppm.erl"]),
    io:format(Fd, "~w ~w~n", [Width, Height]),
    io:format(Fd, "255~n", []),
    rows(Image, Fd),
    file:close(Fd).

%%%===================================================================
%%% Internal functions
%%%===================================================================

rows(Rows, Fd) ->
    lists:foreach(fun(R) -> 
                          Colors = row(R), 
                          io:put_chars(Fd, Colors) 
                  end, Rows).

row(Row) ->
    lists:foldr(fun({R,G,B}, A) -> 
                        [R, G, B | A] end, 
                [], Row).   
